<html>
    <head>
        <script src="engine.mjs"></script>
        <script src="rendering.mjs"></script>
    </head>
    <body>
        <canvas id="game" width="600" height="600"></canvas>
        <p>blue dot: center of mass</br>red line: from center of mass to origin of the cluster</br>blue line: force being applied</p>

        <input type="button" value="reset" onclick="reset()">

        <p>force:</p><input type="number" id="forceX" value="0">
        <input type="number" id="forceY" value="0">
        <p>pos:</p><input type="number" id="forcePosX" value="0">
        <input type="number" id="forcePosY" value="0">
        <br/></p>sausage num:</p><input type="number" id="sausageNum" value="0">

    <script>
        function reset() {
        let testCluster = new cluster(new vector(Math.random()*20, Math.random()*20),Math.floor(Math.random()*1000));
        let testpart1 = new clusterPart(testCluster,"ohno",2,0,0,1);
        let testpart2 = new clusterPart(testCluster,"ohno",1,0,0,1);
        let testpart3 = new clusterPart(testCluster,"ohno",0,0,0,1);
        let testpart4 = new clusterPart(testCluster,"ohno",-1,0,0,1);
        let testpart5 = new clusterPart(testCluster,"ohno",-2,0,0,1);
        testCluster.addPart(testpart1);
        testCluster.addPart(testpart2);
        testCluster.addPart(testpart3);
        testCluster.addPart(testpart4);
        testCluster.addPart(testpart5);


        let testCluster2 = new cluster(new vector(Math.random()*20, Math.random()*20),Math.floor(Math.random()*1000));
        let testpart1b = new clusterPart(testCluster2,"ohno",2,0,0,1);
        let testpart2b = new clusterPart(testCluster2,"ohno",1,0,0,1);
        let testpart3b = new clusterPart(testCluster2,"ohno",0,0,0,1);
        let testpart4b = new clusterPart(testCluster2,"ohno",0,1,0,1);
        let testpart5b = new clusterPart(testCluster2,"ohno",0,2,0,1);
        testCluster2.addPart(testpart1b);
        testCluster2.addPart(testpart2b);
        testCluster2.addPart(testpart3b);
        testCluster2.addPart(testpart4b);
        testCluster2.addPart(testpart5b);


        Vars.world.clusters.push(testCluster);
        Vars.world.clusters.push(testCluster2);

        //apply random force to cluster
        let force = new vector(Math.random()*3, Math.random()*2);
        let pos = new vector(Math.random()*2, Math.random()*3);
        testCluster.applyForce(force, pos);

        let force2 = new vector(Math.random()*2, Math.random()*3);
        let pos2 = new vector(Math.random()*3, Math.random()*2);
        testCluster2.applyForce(force2, pos2);

    }


        Vars.world = new world(64, 64);
        Vars.renderer = new canvasRenderer(document.getElementById("game"));
        
        let forceX = 0;
        let forceY = 0;

        let forcePosX = 0;
        let forcePosY = 0;

        //frame
        let lastTime = performance.now();
        let frame = function(time){
            let delta = (time - lastTime);
            lastTime = time;
            //read input
            forceX = document.getElementById("forceX").value;
            forceY = document.getElementById("forceY").value;
            forcePosX = document.getElementById("forcePosX").value;
            forcePosY = document.getElementById("forcePosY").value;
            let sausageNum = document.getElementById("sausageNum").value;
            sausageNum = Math.min(sausageNum,Vars.world.clusters.length);
            sausageNum = Math.max(sausageNum,0);
            if(Vars.world.clusters.length!=0){
            Vars.world.clusters[sausageNum].applyForce(new vector(forcePosX,forcePosY),new vector(forceX,forceY));
            }
            Vars.world.update(delta/600);
            Vars.renderer.render(Vars.world);
            requestAnimationFrame(frame);
        }        
        requestAnimationFrame(frame);

    </script>
    </body>
</html>